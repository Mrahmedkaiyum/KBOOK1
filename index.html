<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TITAN X-PRO | ELITE</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --neon: #00ffaa;
            --danger: #ff0055;
            --dark: #020408;
            --glass: rgba(255, 255, 255, 0.05);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Rajdhani', sans-serif; }
        body { background: var(--dark); color: #fff; height: 100vh; overflow: hidden; }

        /* [ANIMATED SPLASH SCREEN] */
        #splash-screen {
            position: fixed; inset: 0; background: #000; z-index: 999999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .splash-logo {
            width: 120px; animation: glowPulse 2s infinite alternate;
            border-radius: 50%; border: 3px solid var(--neon); padding: 5px;
        }
        .loader-bar {
            width: 200px; height: 3px; background: #111; margin-top: 30px;
            border-radius: 10px; overflow: hidden;
        }
        .loader-progress {
            width: 0%; height: 100%; background: var(--neon);
            box-shadow: 0 0 15px var(--neon); animation: loadProgress 3s forwards;
        }
        @keyframes glowPulse { from { box-shadow: 0 0 10px var(--neon); } to { box-shadow: 0 0 40px var(--neon); } }
        @keyframes loadProgress { to { width: 100%; } }

        /* [MAIN CONTAINER] */
        #app-shell {
            width: 100%; max-width: 500px; height: 100vh; margin: 0 auto;
            position: relative; display: flex; flex-direction: column;
            background: #000; border-left: 1px solid #111; border-right: 1px solid #111;
        }

        /* [AUTH SYSTEM] */
        .auth-overlay {
            position: absolute; inset: 0; background: var(--dark); z-index: 10000;
            display: flex; align-items: center; justify-content: center; padding: 25px;
        }
        .auth-card {
            width: 100%; background: var(--glass); border: 2px solid var(--neon);
            padding: 40px 25px; border-radius: 25px; backdrop-filter: blur(10px);
        }
        .t-input {
            width: 100%; background: #000; border: 1px solid #222; padding: 15px;
            border-radius: 12px; color: #fff; font-size: 17px; margin-bottom: 20px;
        }
        .t-input:focus { border-color: var(--neon); outline: none; }
        .btn-main {
            width: 100%; padding: 18px; background: var(--neon); color: #000;
            border: none; border-radius: 12px; font-family: 'Orbitron'; font-weight: 900;
            cursor: pointer; font-size: 15px; transition: 0.3s;
        }

        /* [MESSENGER UI] */
        .header { padding: 20px; border-bottom: 1px solid #111; display: flex; justify-content: space-between; align-items: center; }
        .chat-list { flex: 1; overflow-y: auto; }
        .contact-card { display: flex; align-items: center; padding: 15px 20px; border-bottom: 1px solid #080808; cursor: pointer; }
        .contact-card:hover { background: #050505; }
        
        #chat-window { position: absolute; inset: 0; background: #000; z-index: 20000; display: none; flex-direction: column; }
        .msg-area { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; }
        .bubble { max-width: 80%; padding: 12px 18px; border-radius: 15px; margin-bottom: 10px; }
        .sent { background: var(--neon); color: #000; align-self: flex-end; }
        .received { background: #1a1a1a; color: #fff; align-self: flex-start; }

        .hidden { display: none !important; }
        .alert { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); padding: 15px 30px; border-radius: 50px; z-index: 999999; font-weight: bold; display: none; }
    </style>
</head>
<body>

<div id="alert-box" class="alert"></div>

<div id="splash-screen">
    <img src="https://image2url.com/r2/default/images/1770055773770-4e97be2e-90a9-48f4-b20b-bb418a6d3c91.jpg" class="splash-logo">
    <h2 style="font-family:'Orbitron'; color:var(--neon); margin-top:20px; letter-spacing:3px;">TITAN X-PRO</h2>
    <div class="loader-bar"><div class="loader-progress"></div></div>
</div>

<div id="app-shell">
    
    <div id="auth-layer" class="auth-overlay hidden">
        <div class="auth-card">
            <h2 id="auth-title" style="text-align:center; color:var(--neon); font-family:'Orbitron'; margin-bottom:30px;">IDENTITY ACCESS</h2>
            
            <div id="reg-fields" class="hidden">
                <input type="text" id="reg-name" class="t-input" placeholder="আপনার পুরো নাম">
            </div>
            
            <input type="number" id="auth-ph" class="t-input" placeholder="মোবাইল নাম্বার (01XXXXX)">
            <input type="password" id="auth-pk" class="t-input" placeholder="সিকিউরিটি পিন">
            
            <button class="btn-main" onclick="Core.handleAuth()">INITIALIZE CORE</button>
            <p style="text-align:center; margin-top:25px; font-size:14px;">
                <span id="auth-toggle" onclick="Core.toggle()" style="color:var(--neon); cursor:pointer;">অ্যাকাউন্ট নেই? সাইন-আপ করুন</span>
            </p>
        </div>
    </div>

    <div id="main-layer" class="hidden" style="flex:1; display:flex; flex-direction:column;">
        <header class="header">
            <div style="display:flex; align-items:center; gap:12px;">
                <img id="my-avatar" src="https://image2url.com/r2/default/images/1770055773770-4e97be2e-90a9-48f4-b20b-bb418a6d3c91.jpg" style="width:45px; height:45px; border-radius:50%; border:2px solid var(--neon);">
                <div>
                    <h3 id="my-display-name" style="font-family:'Orbitron'; font-size:14px;">TITAN USER</h3>
                    <span style="color:var(--neon); font-size:10px;">● ONLINE</span>
                </div>
            </div>
            <div style="display:flex; gap:15px; font-size:20px;">
                <i class="fas fa-plus-circle" onclick="Core.addFriend()"></i>
                <i class="fas fa-sign-out-alt" style="color:var(--danger);" onclick="Core.logout()"></i>
            </div>
        </header>
        <div id="chat-list" class="chat-list"></div>
    </div>

    <div id="chat-window">
        <header class="header">
            <div style="display:flex; align-items:center; gap:15px;">
                <i class="fas fa-arrow-left" onclick="Chat.close()" style="color:var(--neon); font-size:20px;"></i>
                <h3 id="chat-target-name">FRIEND</h3>
            </div>
        </header>
        <div id="msg-area" class="msg-area"></div>
        <div style="padding:15px; display:flex; gap:10px; background:#0a0a0a;">
            <input type="text" id="msg-input" style="flex:1; padding:12px; background:#000; border:1px solid #222; color:#fff; border-radius:25px;" placeholder="মেসেজ লিখুন...">
            <button onclick="Chat.send()" style="background:var(--neon); border:none; width:45px; height:45px; border-radius:50%;"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>
</div>

<script>
    // ফায়ারবেস কনফিগারেশন
    const config = { databaseURL: "https://kbook-5d175-default-rtdb.firebaseio.com/" };
    firebase.initializeApp(config);
    const db = firebase.database();

    let MY_ID = localStorage.getItem("titan_session") ? atob(localStorage.getItem("titan_session")) : null;
    let ACTIVE_ID = null;
    let IS_REG = false;

    // ১. এনিমেশন কন্ট্রোল
    setTimeout(() => {
        document.getElementById('splash-screen').style.display = 'none';
        if (!MY_ID) {
            document.getElementById('auth-layer').classList.remove('hidden');
        } else {
            Core.loadDashboard();
        }
    }, 3000);

    const Core = {
        toggle: function() {
            IS_REG = !IS_REG;
            document.getElementById('auth-title').innerText = IS_REG ? "CREATE IDENTITY" : "IDENTITY ACCESS";
            document.getElementById('reg-fields').classList.toggle('hidden', !IS_REG);
            document.getElementById('auth-toggle').innerText = IS_REG ? "অ্যাকাউন্ট আছে? লগইন" : "অ্যাকাউন্ট নেই? সাইন-আপ করুন";
        },

        handleAuth: function() {
            const ph = document.getElementById('auth-ph').value;
            const pk = document.getElementById('auth-pk').value;
            if (!ph || pk.length < 4) return this.notify("সঠিক তথ্য দিন!", "red");

            const ref = db.ref('titan_fix/users/' + btoa(ph));

            if (!IS_REG) {
                ref.once('value', s => {
                    if (s.exists() && s.val().pk === pk) {
                        this.finalize(ph);
                    } else if (!s.exists()) {
                        this.notify("অ্যাকাউন্ট নেই! সাইন-আপ করুন।", "red");
                        this.toggle();
                    } else {
                        this.notify("ভুল পিন!", "red");
                    }
                });
            } else {
                ref.once('value', s => {
                    if (s.exists()) {
                        this.notify("নাম্বারটি আগে ব্যবহার হয়েছে!", "red");
                    } else {
                        const name = document.getElementById('reg-name').value || "User";
                        ref.set({ name, ph, pk }).then(() => this.finalize(ph));
                    }
                });
            }
        },

        finalize: function(ph) {
            localStorage.setItem("titan_session", btoa(ph));
            location.reload();
        },

        loadDashboard: function() {
            document.getElementById('main-layer').classList.remove('hidden');
            db.ref('titan_fix/users/' + btoa(MY_ID)).once('value', s => {
                if(s.exists()) document.getElementById('my-display-name').innerText = s.val().name.toUpperCase();
            });
            this.syncFriends();
        },

        addFriend: function() {
            const ph = prompt("বন্ধুর মোবাইল নাম্বার দিন:");
            if (!ph || ph === MY_ID) return;
            db.ref('titan_fix/users/' + btoa(ph)).once('value', s => {
                if (s.exists()) {
                    db.ref('titan_fix/links/' + btoa(MY_ID) + '/' + btoa(ph)).set({ name: s.val().name, ph: ph });
                    db.ref('titan_fix/links/' + btoa(ph) + '/' + btoa(MY_ID)).set({ name: "Friend", ph: MY_ID });
                    this.notify("বন্ধু যোগ হয়েছে!", "green");
                } else {
                    this.notify("ইউজার নেই!", "red");
                }
            });
        },

        syncFriends: function() {
            db.ref('titan_fix/links/' + btoa(MY_ID)).on('value', s => {
                const area = document.getElementById('chat-list');
                area.innerHTML = "";
                s.forEach(c => {
                    const u = c.val();
                    area.innerHTML += `<div class="contact-card" onclick="Chat.open('${u.ph}', '${u.name}')">
                        <img src="https://image2url.com/r2/default/images/1770055773770-4e97be2e-90a9-48f4-b20b-bb418a6d3c91.jpg" style="width:45px; height:45px; border-radius:50%;">
                        <div style="margin-left:15px;"><h4>${u.name}</h4><p style="font-size:11px;color:#444;">${u.ph}</p></div>
                    </div>`;
                });
            });
        },

        notify: function(m, c) {
            const b = document.getElementById('alert-box');
            b.innerText = m; b.style.background = c; b.style.display = 'block';
            setTimeout(() => b.style.display = 'none', 3000);
        },

        logout: function() { localStorage.clear(); location.reload(); }
    };

    const Chat = {
        open: function(ph, name) {
            ACTIVE_ID = ph;
            document.getElementById('chat-target-name').innerText = name;
            document.getElementById('chat-window').style.display = 'flex';
            const ROOM = [btoa(MY_ID), btoa(ph)].sort().join("_X_");
            db.ref('titan_fix/chats/' + ROOM).on('value', s => {
                const area = document.getElementById('msg-area');
                area.innerHTML = "";
                s.forEach(m => {
                    const d = m.val();
                    area.innerHTML += `<div class="bubble ${d.s === MY_ID ? 'sent' : 'received'}">${d.m}</div>`;
                });
                area.scrollTop = area.scrollHeight;
            });
        },
        send: function() {
            const m = document.getElementById('msg-input').value;
            if (!m) return;
            const ROOM = [btoa(MY_ID), btoa(ACTIVE_ID)].sort().join("_X_");
            db.ref('titan_fix/chats/' + ROOM).push({ s: MY_ID, m: m });
            document.getElementById('msg-input').value = "";
        },
        close: function() { document.getElementById('chat-window').style.display = 'none'; }
    };
</script>
</body>
</html>
