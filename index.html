<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Lal Bilai - Fixed Login</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.css"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <style>
        :root { --green: #075E54; --light-green: #25D366; --white: #ffffff; }
        * { box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { margin: 0; background: #000; display: flex; justify-content: center; align-items: center; height: 100vh; }
        #app-wrap { width: 100%; max-width: 400px; height: 95vh; background: var(--white); border-radius: 15px; position: relative; overflow: hidden; display: flex; flex-direction: column; }
        
        /* লগইন ডিজাইন */
        .login-screen { position: absolute; inset: 0; background: white; z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        .iti { width: 100%; margin-bottom: 15px; }
        input { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 8px; outline: none; }
        .login-btn { width: 100%; padding: 12px; background: var(--green); color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        
        /* চ্যাট ইন্টারফেস */
        header { background: var(--green); color: white; padding: 15px; font-weight: bold; display: flex; justify-content: space-between; }
        #chat-list { flex: 1; overflow-y: auto; background: #f0f0f0; }
        .chat-item { padding: 15px; background: white; border-bottom: 1px solid #eee; display: flex; align-items: center; cursor: pointer; }
        .chat-item img { width: 45px; height: 45px; border-radius: 50%; margin-right: 15px; }
    </style>
</head>
<body>

<div id="app-wrap">
    <div id="login-scr" class="login-screen">
        <img src="https://image2url.com/r2/default/images/1770055773770-4e97be2e-90a9-48f4-b20b-bb418a6d3c91.jpg" style="width:80px; border-radius:50%; margin-bottom:20px;">
        <h2 style="margin-bottom:20px; color:var(--green)">Lal Bilai Login</h2>
        <input type="tel" id="l-ph">
        <input type="password" id="l-ps" placeholder="পাসওয়ার্ড লিখুন" style="margin-top:10px;">
        <button class="login-btn" onclick="handleLogin()">Login</button>
        <p style="font-size:12px; margin-top:15px; color:gray;">অ্যাকাউন্ট না থাকলে অ্যাডমিনকে জানান।</p>
    </div>

    <header>
        <span>Lal Bilai Messenger</span>
        <span onclick="logout()" style="font-size:12px; cursor:pointer;">Logout</span>
    </header>
    <div id="chat-list">
        </div>
</div>

<script>
    // Firebase Initialization
    const firebaseConfig = { databaseURL: "https://kbook-5d175-default-rtdb.firebaseio.com/" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let iti;
    // ইনপুট বক্স সেটআপ
    window.onload = () => {
        const input = document.querySelector("#l-ph");
        iti = window.intlTelInput(input, {
            separateDialCode: true,
            initialCountry: "sa", // সৌদি আরব ডিফল্ট
            utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js"
        });

        // যদি আগে লগইন করা থাকে
        if(localStorage.getItem("lb_phone")) {
            document.getElementById('login-scr').style.display = 'none';
            loadChats();
        }
    };

    // ফিক্সড লগইন ফাংশন
    function handleLogin() {
        const phoneNumber = iti.getNumber(); // কান্ট্রি কোডসহ ফুল নাম্বার নেয়
        const password = document.getElementById('l-ps').value;

        if(!phoneNumber || !password) {
            alert("নাম্বার এবং পাসওয়ার্ড দিন!");
            return;
        }

        const userKey = btoa(phoneNumber); // নাম্বারকে আইডি হিসেবে ব্যবহার

        db.ref('users/' + userKey).once('value', snap => {
            const userData = snap.val();
            if(userData) {
                if(userData.pass === password) {
                    localStorage.setItem("lb_phone", userKey);
                    alert("লগইন সফল!");
                    location.reload(); // পেজ রিলোড দিয়ে অ্যাপে ঢুকবে
                } else {
                    alert("ভুল পাসওয়ার্ড!");
                }
            } else {
                alert("এই নাম্বারে কোনো অ্যাকাউন্ট পাওয়া যায়নি!");
            }
        });
    }

    function loadChats() {
        // চ্যাট লিস্ট লোড করার লজিক এখানে থাকবে
        console.log("Logged in as: " + atob(localStorage.getItem("lb_phone")));
    }

    function logout() {
        localStorage.clear();
        location.reload();
    }
</script>
</body>
</html>
